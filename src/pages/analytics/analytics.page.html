<section class="mx-auto flex min-h-[calc(100vh-4rem)] max-w-4xl flex-col justify-center px-6 py-16">
  <sf-card>
    <h1 class="text-3xl font-semibold tracking-tight sm:text-4xl">Analytics</h1>
    <p class="mt-3 text-base text-slate-300 sm:text-lg">
      Track momentum, mastery, and the signals that prove real growth.
    </p>
    <p class="mt-2 text-sm text-slate-400">Active scenarios tracked: {{ scenariosCount() }}</p>
    <p class="mt-1 text-sm text-slate-400">Decisions logged: {{ decisionCount() }}</p>
    <div class="mt-5 flex flex-wrap gap-3">
      <sf-button variant="ghost" (click)="logDecision()">Log sample decision</sf-button>
    </div>
  </sf-card>

  @if (skillsError() || scenariosError()) {
    <sf-card class="mt-6">
      <div
        class="rounded-xl border border-rose-500/40 bg-rose-500/10 px-4 py-3 text-sm text-rose-200"
      >
        @if (skillsError()) {
          <div>{{ skillsError() }}</div>
        }
        @if (scenariosError()) {
          <div>{{ scenariosError() }}</div>
        }
      </div>
    </sf-card>
  }

  <sf-card class="mt-6">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <h2 class="text-lg font-semibold text-slate-100">Decision history</h2>
        <p class="mt-1 text-sm text-slate-400">Last 5 decisions</p>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <sf-button
          variant="ghost"
          type="button"
          [disabled]="!canUndoDecision()"
          (click)="undoLastDecision()"
        >
          Undo last decision
        </sf-button>
        <sf-button variant="ghost" type="button" (click)="clearHistory()">
          Clear history
        </sf-button>
      </div>
    </div>

    <div class="mt-4 grid gap-3">
      @for (entry of recentHistory(); track entry.key) {
        <div class="rounded-xl border border-slate-800/80 bg-slate-950/40 px-4 py-3">
          <div class="text-xs text-slate-500">{{ entry.formattedDate }}</div>
          <div class="mt-1 text-sm font-semibold text-slate-100">
            {{ entry.scenarioTitle }}
          </div>
          <div class="mt-1 text-sm text-slate-300">{{ entry.decisionText }}</div>
          <div class="mt-2 text-xs text-slate-400">Effects: {{ entry.effectsText }}</div>
        </div>
      } @empty {
        <sf-empty-state
          size="sm"
          title="No decisions yet"
          description="Run a simulator scenario to generate decision history."
        ></sf-empty-state>
      }
    </div>
  </sf-card>

  <sf-card class="mt-6">
    <div class="grid gap-6 md:grid-cols-[1.1fr_0.9fr]">
      <div>
        <h2 class="text-lg font-semibold text-slate-100">Top skills by level</h2>
        <p class="mt-1 text-sm text-slate-400">
          Top {{ topSkills().length }} skills based on current level.
        </p>
        @if (skillsError()) {
          <div class="mt-4 text-sm text-slate-400">Skills unavailable due to an error.</div>
        } @else {
          <div class="mt-4 grid gap-3">
            @for (skill of topSkills(); track skill.id) {
              <div class="rounded-xl border border-slate-800/80 bg-slate-950/40 px-4 py-3">
                <div class="text-sm font-semibold text-slate-100">{{ skill.name }}</div>
                <div class="mt-1 text-xs text-slate-400">
                  {{ skill.category }} Â· Level {{ skill.level }} / {{ skill.maxLevel }}
                </div>
              </div>
            } @empty {
              <sf-empty-state
                size="sm"
                title="No skills yet"
                description="Finish onboarding to seed your initial skills."
              ></sf-empty-state>
            }
          </div>
        }
      </div>

      <div>
        <h2 class="text-lg font-semibold text-slate-100">Progress line</h2>
        <p class="mt-1 text-sm text-slate-400">
          Scenarios completed: {{ completedScenarios() }} / {{ scenariosCount() }}
        </p>
        <div class="mt-4 rounded-2xl border border-slate-800/80 bg-slate-950/40 p-4">
          @if (progressChart().points) {
            <svg viewBox="0 0 120 40" class="h-28 w-full">
              <polyline
                [attr.points]="progressChart().points"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                class="text-emerald-300"
              ></polyline>
            </svg>
            <div class="mt-2 text-xs text-slate-400">
              Total decisions: {{ progressChart().latest }}
            </div>
          } @else {
            <sf-empty-state
              size="sm"
              title="No progress yet"
              description="Complete scenarios to build a timeline."
            ></sf-empty-state>
          }
        </div>
      </div>
    </div>
  </sf-card>
</section>
