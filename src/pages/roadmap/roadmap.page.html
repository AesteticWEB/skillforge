<section class="mx-auto flex min-h-[calc(100vh-4rem)] max-w-5xl flex-col gap-6 px-6 py-16">
  <sf-card>
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <h1 class="text-3xl font-semibold tracking-tight sm:text-4xl">Путь</h1>
        <p class="mt-3 text-base text-slate-300 sm:text-lg">
          Карьерный и company-трек с условиями повышения.
        </p>
      </div>
      @if (viewModel().isNgPlus) {
        <span
          class="rounded-full border border-amber-300/40 bg-amber-300/10 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-amber-200"
        >
          NG+
        </span>
      }
    </div>
    @if (viewModel().isNgPlus) {
      <div class="mt-3 text-xs text-amber-200">В NG+ требования выше.</div>
    }
  </sf-card>

  @if (!isRegistered() || !hasProfile()) {
    <sf-card>
      <sf-empty-state
        title="Сначала создай профиль"
        description="Зарегистрируйся и выбери профессию, чтобы увидеть путь развития."
      ></sf-empty-state>
    </sf-card>
  } @else {
    @if (viewModel(); as vm) {
      <sf-card>
        <div class="flex flex-wrap items-start justify-between gap-4">
          <div>
            <div class="text-xs font-semibold uppercase tracking-wide text-slate-400">
              Career Track
            </div>
            <div class="mt-1 text-lg font-semibold text-slate-100">
              Текущий этап: {{ vm.career.currentStageLabel }}
            </div>
          </div>
          <div class="text-xs text-slate-500">Internship → Junior → Middle → Senior</div>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          @for (stage of vm.career.stages; track stage.id) {
            <div
              class="flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold"
              [ngClass]="careerStageClass(stage.status)"
            >
              <span>{{ stage.label }}</span>
              <span class="text-[10px] uppercase tracking-wide text-slate-400">
                {{ stage.statusLabel }}
              </span>
            </div>
          }
        </div>

        <div class="mt-4 grid gap-3 sm:grid-cols-3">
          <div class="rounded-xl border border-slate-800/80 bg-slate-950/40 px-4 py-3 text-sm">
            Навыки:
            <span class="font-semibold text-slate-100">{{ vm.career.skillsMasteredCurrent }}</span
            >/{{ vm.career.skillsTotal }}
          </div>
          <div class="rounded-xl border border-slate-800/80 bg-slate-950/40 px-4 py-3 text-sm">
            Сценарии:
            <span class="font-semibold text-slate-100">{{
              vm.career.scenariosCompletedCurrent
            }}</span
            >/{{ vm.career.scenariosTotal }}
          </div>
          <div class="rounded-xl border border-slate-800/80 bg-slate-950/40 px-4 py-3 text-sm">
            @if (vm.career.examAvailable) {
              Экзамен:
              <span class="font-semibold text-slate-100">
                {{ vm.career.hasCertForCurrentStage ? 'есть сертификат' : 'нет сертификата' }}
              </span>
            } @else {
              Экзамен: <span class="font-semibold text-slate-100">не требуется</span>
            }
          </div>
        </div>

        <div class="mt-4 rounded-xl border border-slate-800/80 bg-slate-950/40 px-4 py-4">
          <div class="text-xs font-semibold uppercase tracking-wide text-slate-400">
            Условия повышения
          </div>
          <div class="mt-2 grid gap-1 text-sm text-slate-200">
            @for (reason of vm.career.missingReasons; track reason) {
              <div>• {{ reason }}</div>
            }
          </div>
        </div>

        <div class="mt-4 grid gap-3 sm:grid-cols-3">
          <div class="grid gap-1">
            <sf-button
              type="button"
              [disabled]="scenarioCta().disabled"
              (click)="goTo('/simulator')"
            >
              Перейти к сценариям
            </sf-button>
            @if (scenarioCta().reason) {
              <div class="text-xs text-slate-400">{{ scenarioCta().reason }}</div>
            }
          </div>
          <div class="grid gap-1">
            <sf-button type="button" [disabled]="skillCta().disabled" (click)="goTo('/skills')">
              Прокачать навыки
            </sf-button>
            @if (skillCta().reason) {
              <div class="text-xs text-slate-400">{{ skillCta().reason }}</div>
            }
          </div>
          <div class="grid gap-1">
            <sf-button type="button" [disabled]="examCta().disabled" (click)="goTo('/exam')">
              Сдать экзамен
            </sf-button>
            @if (examCta().reason) {
              <div class="text-xs text-slate-400">{{ examCta().reason }}</div>
            }
          </div>
        </div>
      </sf-card>

      <sf-card>
        <div class="flex flex-wrap items-start justify-between gap-4">
          <div>
            <div class="text-xs font-semibold uppercase tracking-wide text-slate-400">
              Company Track
            </div>
            <div class="mt-1 text-lg font-semibold text-slate-100">Уровни компании</div>
          </div>
          <div class="text-xs text-slate-500">Locked → Lead → Manager → Director → CTO</div>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          @for (level of vm.company.levels; track level.id) {
            <div
              class="flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold"
              [ngClass]="companyStageClass(level.status)"
            >
              <span>{{ level.label }}</span>
              <span class="text-[10px] uppercase tracking-wide text-slate-400">
                {{ level.statusLabel }}
              </span>
            </div>
          }
        </div>

        @if (!vm.company.isCompanyUnlocked) {
          <div class="mt-4 rounded-xl border border-rose-500/40 bg-rose-500/10 px-4 py-3">
            <div class="text-sm font-semibold text-rose-100">Company mode закрыт</div>
            <div class="mt-2 grid gap-1 text-sm text-rose-200">
              @for (reason of vm.company.missingReasons; track reason) {
                <div>• {{ reason }}</div>
              }
            </div>
          </div>
        }

        <div class="mt-4 grid gap-3 sm:grid-cols-2">
          <div class="grid gap-1">
            <sf-button type="button" [disabled]="companyCta().disabled" (click)="goTo('/company')">
              В компанию
            </sf-button>
            @if (companyCta().reason) {
              <div class="text-xs text-slate-400">{{ companyCta().reason }}</div>
            }
          </div>
        </div>
      </sf-card>
    }
  }
</section>
