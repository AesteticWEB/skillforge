<section class="mx-auto flex min-h-[calc(100vh-4rem)] max-w-4xl flex-col gap-6 px-6 py-16">
  <sf-card>
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <h1 class="text-3xl font-semibold tracking-tight sm:text-4xl">
          {{ ending()?.title ?? 'Финал завершён' }}
        </h1>
        <p class="mt-3 text-base text-slate-300 sm:text-lg">
          Итог игры зафиксирован. Спасибо за прохождение!
        </p>
        <p class="mt-2 text-xs text-slate-500">
          {{ endingFinishedAt() ? 'Завершено: ' + formatDate(endingFinishedAt()) : '' }}
        </p>
      </div>
      <div
        class="rounded-xl border border-slate-800/80 bg-slate-950/40 px-4 py-2 text-xs text-slate-300"
      >
        Концовка: {{ ending()?.endingId ? formatEndingId(ending()?.endingId ?? '') : '—' }}
      </div>
    </div>

    <div class="ending-summary mt-4 grid gap-2 text-sm text-slate-200">
      @for (line of summaryLines(); track $index) {
        <div>{{ line }}</div>
      } @empty {
        <div>Итоги совета директоров зафиксированы.</div>
      }
    </div>
  </sf-card>

  <sf-card>
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <h2 class="text-lg font-semibold text-slate-100">Статистика</h2>
        <p class="mt-1 text-sm text-slate-400">Ключевые показатели на момент финала.</p>
      </div>
    </div>

    <div class="mt-4 grid gap-2 text-sm text-slate-300">
      @for (row of statsRows(); track row.label) {
        <div class="flex items-center justify-between gap-3 rounded-lg bg-slate-950/40 px-3 py-2">
          <div>{{ row.label }}</div>
          <div class="text-sm font-semibold text-slate-100">{{ row.value }}</div>
        </div>
      } @empty {
        <div class="text-sm text-slate-500">Нет данных для отображения.</div>
      }
    </div>
  </sf-card>

  <sf-card>
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <h2 class="text-lg font-semibold text-slate-100">Действия</h2>
        <p class="mt-1 text-sm text-slate-400">Выбери следующий шаг.</p>
      </div>
    </div>

    <div class="mt-4 flex flex-wrap gap-3">
      <sf-button type="button" [disabled]="!canContinue()" (click)="continueGame()">
        Продолжить
      </sf-button>
      <sf-button type="button" variant="ghost" (click)="startNewGamePlus()">
        Новая игра+
      </sf-button>
      <sf-button type="button" variant="ghost" (click)="startNewGame()"> Новая игра </sf-button>
    </div>
    @if (!canContinue()) {
      <div class="mt-3 text-xs text-slate-500">Продолжение недоступно для этой концовки.</div>
    }
  </sf-card>

  <sf-card>
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <h2 class="text-lg font-semibold text-slate-100">История концовок</h2>
        <p class="mt-1 text-sm text-slate-400">Последние завершённые прохождения.</p>
      </div>
    </div>

    <div class="mt-4 grid gap-2 text-sm text-slate-300">
      @for (entry of historyPreview(); track entry.finishedAtIso) {
        <div class="rounded-xl border border-slate-800/80 bg-slate-950/40 px-4 py-3">
          <div class="flex flex-wrap items-center justify-between gap-2">
            <div class="text-sm font-semibold text-slate-100">
              {{ formatHistoryTitle(entry) }}
            </div>
            <div class="text-xs text-slate-500">{{ formatDate(entry.finishedAtIso) }}</div>
          </div>
          <div class="mt-2 text-xs text-slate-400">
            Концовка: {{ formatEndingId(entry.endingId) }}
          </div>
        </div>
      } @empty {
        <div class="text-sm text-slate-500">История концовок пока пуста.</div>
      }
    </div>
  </sf-card>
</section>
