generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

enum UserRole {
  admin
  user
}

model User {
  id           String   @id @default(cuid())
  login        String   @unique
  passwordHash String
  role         UserRole @default(user)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  progress     UserProgress?
}

model UserProgress {
  id        String   @id @default(cuid())
  userId    String   @unique
  stateJson String
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Item {
  id          String  @id
  title       String
  description String
  priceCoins  Int
  priceCash   Int?
  rarity      String
  effectsJson String
  enabled     Boolean @default(true)
}

model Scenario {
  id          String           @id
  profession  String
  stage       String
  title       String
  description String
  rewardXp    Int
  rewardCoins Int
  enabled     Boolean          @default(true)
  options     ScenarioOption[]
}

model ScenarioOption {
  id         String   @id
  scenarioId String
  text       String
  isCorrect  Boolean
  effectsJson String

  scenario Scenario @relation(fields: [scenarioId], references: [id], onDelete: Cascade)
}

model Exam {
  id            String  @id
  profession    String
  stage         String
  passScore     Int
  questionCount Int
  enabled       Boolean @default(true)
}

model Question {
  id          String         @id
  profession  String?
  text        String
  tagsJson    String
  difficulty  Int?
  enabled     Boolean        @default(true)
  options     AnswerOption[]
}

model AnswerOption {
  id          String   @id
  questionId  String
  text        String
  isCorrect   Boolean
  explanation String

  question Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
}

model QuickFix {
  id          String  @id
  title       String
  description String
  rewardCoins Int
  enabled     Boolean @default(true)
}

model Incident {
  id          String           @id
  title       String
  description String
  severity    String
  enabled     Boolean          @default(true)
  options     IncidentOption[]
}

model IncidentOption {
  id         String   @id
  incidentId String
  text       String
  effectsJson String

  incident Incident @relation(fields: [incidentId], references: [id], onDelete: Cascade)
}
